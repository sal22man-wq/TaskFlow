import { execSync } from 'child_process';
import fs from 'fs';
import path from 'path';

console.log('๐ ุฅูุดุงุก TaskFlow - ุงูุฅุตุฏุงุฑ ุงููุณุชูู ุงูุดุงูู');
console.log('ุดุฑูุฉ ุงุดุฑุงู ุงููุฏู ูุชูููููุฌูุง ุงููุนูููุงุช');
console.log('===============================================');

// ุฅูุดุงุก ูุฌูุฏ ุงูุจูุงุก
if (!fs.existsSync('TaskFlow-Standalone')) {
  fs.mkdirSync('TaskFlow-Standalone');
}

console.log('๐ฆ [1/8] ุจูุงุก ุงูุชุทุจูู...');
try {
  execSync('npm run build', { stdio: 'inherit' });
  console.log('โ ุชู ุจูุงุก ุงูุชุทุจูู');
} catch (error) {
  console.error('โ ุฎุทุฃ ูู ุจูุงุก ุงูุชุทุจูู');
  process.exit(1);
}

console.log('โ๏ธ [2/8] ุฅุนุฏุงุฏ ููู ุงูุชูููู...');
// ุฅูุดุงุก package.json ูุฎุตุต ููู exe
const pkgConfig = {
  "name": "taskflow-server",
  "version": "1.0.0",
  "description": "TaskFlow - ูุธุงู ุฅุฏุงุฑุฉ ุงูููุงู ูุงููุฑู",
  "main": "dist/index.js",
  "type": "module",
  "bin": "dist/index.js",
  "pkg": {
    "scripts": [
      "dist/**/*.js"
    ],
    "assets": [
      "client/dist/**/*",
      "node_modules/@neondatabase/**/*",
      "node_modules/whatsapp-web.js/**/*",
      "node_modules/qrcode/**/*",
      "node_modules/express/**/*",
      "node_modules/drizzle-orm/**/*"
    ],
    "targets": [
      "node18-win-x64"
    ]
  }
};

fs.writeFileSync('package-standalone.json', JSON.stringify(pkgConfig, null, 2));

console.log('๐๏ธ [3/8] ุฅูุดุงุก ุงูููู ุงูุชูููุฐู...');
try {
  execSync('npx pkg . --config package-standalone.json --output TaskFlow-Standalone/TaskFlow.exe', { stdio: 'inherit' });
  console.log('โ ุชู ุฅูุดุงุก ุงูููู ุงูุชูููุฐู');
} catch (error) {
  console.error('โ ุฎุทุฃ ูู ุฅูุดุงุก ุงูููู ุงูุชูููุฐู');
  process.exit(1);
}

console.log('๐ [4/8] ูุณุฎ ุงููููุงุช ุงูุถุฑูุฑูุฉ...');
// ูุณุฎ ูููุงุช ุงููุงุฌูุฉ ุงูุฃูุงููุฉ
if (fs.existsSync('client/dist')) {
  execSync('xcopy client\\dist TaskFlow-Standalone\\client\\dist /E /I /Y /Q', { stdio: 'inherit' });
}

// ูุณุฎ ูููุงุช ุงูุฅุนุฏุงุฏ
if (fs.existsSync('.env.example')) {
  fs.copyFileSync('.env.example', 'TaskFlow-Standalone/.env.example');
}

console.log('โก [5/8] ุฅูุดุงุก ุณูุฑููพุช ุงูุชุดุบูู ุงูุฐูู...');
const startScript = `@echo off
chcp 65001 >nul
title TaskFlow - Windows Server
color 0A

echo ===============================================
echo      TaskFlow - ูุธุงู ุฅุฏุงุฑุฉ ุงูููุงู ูุงููุฑู
echo      ุดุฑูุฉ ุงุดุฑุงู ุงููุฏู ูุชูููููุฌูุง ุงููุนูููุงุช
echo ===============================================
echo.

echo [%time%] ูุญุต ุจูุฆุฉ ูููุฏูุฒ ุณูุฑูุฑ...
echo ุงูุฎุงุฏู: %COMPUTERNAME%
echo ุงููุณุชุฎุฏู: %USERNAME%
echo ุงููุฌูุฏ: %CD%
echo.

:: ุงูุชุญูู ูู ูุฌูุฏ ููู .env
if not exist .env (
    echo [%time%] ุฅูุดุงุก ููู ุงูุฅุนุฏุงุฏุงุช...
    if exist .env.example (
        copy .env.example .env >nul
        echo โ ุชู ุฅูุดุงุก ููู .env ูู ุงููุงูุจ
    ) else (
        echo # TaskFlow Configuration > .env
        echo DATABASE_URL=postgresql://postgres:password@localhost:5432/taskflow_db >> .env
        echo SESSION_SECRET=%RANDOM%%RANDOM%%RANDOM% >> .env
        echo NODE_ENV=production >> .env
        echo PORT=5000 >> .env
        echo โ ุชู ุฅูุดุงุก ููู .env ุงูุชุฑุงุถู
    )
    echo.
    echo โ๏ธ ูุฑุฌู ุชุนุฏูู ููู .env ุจุฅุนุฏุงุฏุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุตุญูุญุฉ
    echo ุซู ุงุถุบุท ุฃู ููุชุงุญ ูููุชุงุจุนุฉ...
    pause
)

:: ุชุญููู ูุชุบูุฑุงุช ุงูุจูุฆุฉ ูู ููู .env
for /f "usebackq tokens=1,2 delims==" %%i in (.env) do (
    if not "%%i"=="" if not "%%i"=="#" (
        set "%%i=%%j"
    )
)

echo [%time%] ุฅุนุฏุงุฏ ูุชุบูุฑุงุช ุงูุจูุฆุฉ...
if not defined NODE_ENV set NODE_ENV=production
if not defined PORT set PORT=5000

echo [%time%] ูุชุญ ุงููููุฐ ูู Windows Firewall...
netsh advfirewall firewall show rule name="TaskFlow Application" >nul 2>&1
if %errorlevel% neq 0 (
    netsh advfirewall firewall add rule name="TaskFlow Application" dir=in action=allow protocol=TCP localport=%PORT% >nul 2>&1
    if %errorlevel% equ 0 (
        echo โ ุชู ูุชุญ ุงููููุฐ %PORT% ูู Windows Firewall
    ) else (
        echo โ๏ธ ุชุนุฐุฑ ูุชุญ ุงููููุฐ - ูุฏ ุชุญุชุงุฌ ุตูุงุญูุงุช ูุฏูุฑ
    )
) else (
    echo โ ุงููููุฐ %PORT% ููุชูุญ ูุณุจูุงู ูู Windows Firewall
)

echo [%time%] ุจุฏุก ุชุดุบูู ุฎุงุฏู TaskFlow...
echo.
echo ===============================================
echo ูุนูููุงุช ุงูุฎุงุฏู:
echo - ุงูุจูุฆุฉ: %NODE_ENV%
echo - ุงููููุฐ: %PORT%
echo - ุงูุฑุงุจุท ุงููุญูู: http://localhost:%PORT%
echo - ุงูุฑุงุจุท ุนูู ุงูุดุจูุฉ: http://%COMPUTERNAME%:%PORT%
echo ===============================================
echo.
echo ุจูุงูุงุช ุชุณุฌูู ุงูุฏุฎูู ุงูุงูุชุฑุงุถูุฉ:
echo ุงุณู ุงููุณุชุฎุฏู: administrator
echo ูููุฉ ุงููุฑูุฑ: wdq@#$
echo.
echo ุชุญูู ูู ุงูุฎุงุฏู:
echo - ุงุถุบุท Ctrl+C ูุฅููุงู ุงูุฎุงุฏู
echo - ุฃุบูู ุงููุงูุฐุฉ ูุฅููุงู ุงูุฎุงุฏู
echo ===============================================
echo.

:: ุชุดุบูู ุงูุชุทุจูู
TaskFlow.exe

echo.
echo [%time%] ุชู ุฅููุงู ุฎุงุฏู TaskFlow
echo ุงุถุบุท ุฃู ููุชุงุญ ููุฅุบูุงู...
pause`;

fs.writeFileSync('TaskFlow-Standalone/ุชุดุบูู TaskFlow.bat', startScript);

console.log('๐ง [6/8] ุฅูุดุงุก ุฃุฏูุงุช ุงูุฅุฏุงุฑุฉ...');
// ุณูุฑููพุช ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช
const dbSetupScript = `@echo off
chcp 65001 >nul
title ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช - TaskFlow
color 0B

echo ===============================================
echo      ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช - TaskFlow
echo      ุดุฑูุฉ ุงุดุฑุงู ุงููุฏู ูุชูููููุฌูุง ุงููุนูููุงุช
echo ===============================================
echo.

echo ูุฐุง ุงูุณูุฑููพุช ุณูุณุงุนุฏู ูู ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช
echo.

echo ุงูุฎุทูุงุช ุงููุทููุจุฉ:
echo 1. ุชุฃูุฏ ูู ุชุซุจูุช PostgreSQL
echo 2. ุฅูุดุงุก ูุงุนุฏุฉ ุจูุงูุงุช ุฌุฏูุฏุฉ
echo 3. ุชุนุฏูู ููู .env
echo.

echo [1] ุงูุชุญูู ูู PostgreSQL...
psql --version >nul 2>&1
if %errorlevel% neq 0 (
    echo โ PostgreSQL ุบูุฑ ูุซุจุช ุฃู ุบูุฑ ูุชุงุญ
    echo.
    echo ูุฑุฌู ุชุซุจูุช PostgreSQL ูู:
    echo https://www.postgresql.org/download/windows/
    echo.
    pause
    exit /b 1
) else (
    echo โ PostgreSQL ูุชุงุญ
    psql --version
)

echo.
echo [2] ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช...
echo.
set /p POSTGRES_PASSWORD=ุฃุฏุฎู ูููุฉ ูุฑูุฑ PostgreSQL: 
echo.

echo ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช taskflow_db...
psql -U postgres -h localhost -c "CREATE DATABASE taskflow_db;" postgresql://postgres:%POSTGRES_PASSWORD%@localhost:5432/postgres

if %errorlevel% equ 0 (
    echo โ ุชู ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุฌุงุญ
) else (
    echo โ๏ธ ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุฌูุฏุฉ ูุณุจูุงู ุฃู ุญุฏุซ ุฎุทุฃ
)

echo.
echo [3] ุชุญุฏูุซ ููู .env...
if exist .env (
    echo ุชุญุฏูุซ ุฅุนุฏุงุฏุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู .env...
    powershell -Command "(Get-Content .env) -replace 'DATABASE_URL=.*', 'DATABASE_URL=postgresql://postgres:%POSTGRES_PASSWORD%@localhost:5432/taskflow_db' | Set-Content .env"
    echo โ ุชู ุชุญุฏูุซ ููู .env
) else (
    echo ุฅูุดุงุก ููู .env ุฌุฏูุฏ...
    echo DATABASE_URL=postgresql://postgres:%POSTGRES_PASSWORD%@localhost:5432/taskflow_db > .env
    echo SESSION_SECRET=%RANDOM%%RANDOM%%RANDOM% >> .env
    echo NODE_ENV=production >> .env
    echo PORT=5000 >> .env
    echo โ ุชู ุฅูุดุงุก ููู .env
)

echo.
echo ===============================================
echo          ุชู ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช!
echo ===============================================
echo.
echo ููููู ุงูุขู ุชุดุบูู TaskFlow ุจุงุณุชุฎุฏุงู:
echo "ุชุดุบูู TaskFlow.bat"
echo.
pause`;

fs.writeFileSync('TaskFlow-Standalone/ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช.bat', dbSetupScript);

// ุณูุฑููพุช ุงูุชุซุจูุช ูุฎุฏูุฉ ูููุฏูุฒ
const serviceScript = `@echo off
chcp 65001 >nul
title ุชุซุจูุช TaskFlow ูุฎุฏูุฉ ูููุฏูุฒ
color 0E

echo ===============================================
echo      ุชุซุจูุช TaskFlow ูุฎุฏูุฉ ูููุฏูุฒ
echo      ุดุฑูุฉ ุงุดุฑุงู ุงููุฏู ูุชูููููุฌูุง ุงููุนูููุงุช
echo ===============================================
echo.

echo ูุฐุง ุงูุณูุฑููพุช ุณูุซุจุช TaskFlow ูุฎุฏูุฉ ูููุฏูุฒ
echo ุจุญูุซ ูุนูู ุชููุงุฆูุงู ุนูุฏ ุจุฏุก ุชุดุบูู ุงูุฎุงุฏู
echo.

:: ุงูุชุญูู ูู ุตูุงุญูุงุช ุงููุฏูุฑ
net session >nul 2>&1
if %errorlevel% neq 0 (
    echo โ ูุฌุจ ุชุดุบูู ูุฐุง ุงูุณูุฑููพุช ููุฏูุฑ
    echo ุงุถุบุท ุจุงูุฒุฑ ุงูุฃููู ูุงุฎุชุฑ "ุชุดุบูู ููุฏูุฑ"
    pause
    exit /b 1
)

echo [1/4] ุชุซุจูุช PM2 ุนุงูููุงู...
call npm install -g pm2 pm2-windows-service

echo [2/4] ุฅุนุฏุงุฏ PM2 ูุฎุฏูุฉ ูููุฏูุฒ...
call pm2-service-install -n PM2

echo [3/4] ุฅุถุงูุฉ TaskFlow ูู PM2...
call pm2 start "ุชุดุบูู TaskFlow.bat" --name TaskFlow

echo [4/4] ุญูุธ ุฅุนุฏุงุฏุงุช PM2...
call pm2 save

echo.
echo ===============================================
echo        ุชู ุชุซุจูุช TaskFlow ูุฎุฏูุฉ ูููุฏูุฒ!
echo ===============================================
echo.
echo ุฃูุงูุฑ ุฅุฏุงุฑุฉ ุงูุฎุฏูุฉ:
echo pm2 list          - ุนุฑุถ ุญุงูุฉ ุงูุฎุฏูุงุช
echo pm2 restart TaskFlow - ุฅุนุงุฏุฉ ุชุดุบูู TaskFlow
echo pm2 stop TaskFlow     - ุฅููุงู TaskFlow
echo pm2 logs TaskFlow     - ุนุฑุถ ุณุฌูุงุช TaskFlow
echo.
pause`;

fs.writeFileSync('TaskFlow-Standalone/ุชุซุจูุช ูุฎุฏูุฉ ูููุฏูุฒ.bat', serviceScript);

console.log('๐ [7/8] ุฅูุดุงุก ุงููุซุงุฆู...');
// ุฏููู ุงููุณุชุฎุฏู ุงูุดุงูู
const userGuide = `# TaskFlow - ุฏููู ุงููุณุชุฎุฏู ุงูุดุงูู
ุดุฑูุฉ ุงุดุฑุงู ุงููุฏู ูุชูููููุฌูุง ุงููุนูููุงุช

## ูุธุฑุฉ ุนุงูุฉ
TaskFlow ูู ูุธุงู ุดุงูู ูุฅุฏุงุฑุฉ ุงูููุงู ูุงููุฑู ูุชุถูู:
- ุฅุฏุงุฑุฉ ุงูููุงู ูุงููุดุงุฑูุน
- ูุธุงู ุงููุฑุงุณูุฉ ุงูููุฑู
- ุชูููู ุฑุถุง ุงูุนููุงุก ุนุจุฑ ูุงุชุณุงุจ
- ูุธุงู ุงูููุงุท ูุงูููุงูุขุช
- ุฅุฏุงุฑุฉ ุนูุงูุงุช ุงูุนููุงุก ูุน GPS
- ูุงุฌูุฉ ุนุฑุจูุฉ ูุงููุฉ

## ูุชุทูุจุงุช ุงููุธุงู
- Windows Server 2016 ุฃู ุฃุญุฏุซ
- PostgreSQL 12 ุฃู ุฃุญุฏุซ
- 4 GB RAM (8 GB ูููุตู ุจู)
- 2 GB ูุณุงุญุฉ ุญุฑุฉ

## ุงูุชุซุจูุช ุงูุณุฑูุน (ุจููุฑุฉ ูุงุญุฏุฉ)

### ุงูุทุฑููุฉ ุงูุฃููู: ุงูุชุดุบูู ุงููุจุงุดุฑ
1. ุดุบู "ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช.bat" (ูุฑุฉ ูุงุญุฏุฉ ููุท)
2. ุดุบู "ุชุดุบูู TaskFlow.bat"

### ุงูุทุฑููุฉ ุงูุซุงููุฉ: ูุฎุฏูุฉ ูููุฏูุฒ
1. ุดุบู "ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช.bat" (ูุฑุฉ ูุงุญุฏุฉ ููุท)  
2. ุดุบู "ุชุซุจูุช ูุฎุฏูุฉ ูููุฏูุฒ.bat" ููุฏูุฑ

## ุงููุตูู ุฅูู ุงูุชุทุจูู
- ุงูุฑุงุจุท ุงููุญูู: http://localhost:5000
- ุงูุฑุงุจุท ุนูู ุงูุดุจูุฉ: http://[ุงุณู-ุงูุฎุงุฏู]:5000

## ุจูุงูุงุช ุชุณุฌูู ุงูุฏุฎูู ุงูุงูุชุฑุงุถูุฉ
- ุงุณู ุงููุณุชุฎุฏู: administrator
- ูููุฉ ุงููุฑูุฑ: wdq@#$

โ๏ธ ููู: ุบูุฑ ูููุฉ ุงููุฑูุฑ ููุฑ ุชุณุฌูู ุงูุฏุฎูู

## ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

### 1. ุฅุฏุงุฑุฉ ุงูููุงู
- ุฅูุดุงุก ูุชุนุฏูู ุงูููุงู
- ุชุชุจุน ุงูุชูุฏู ูุงูุญุงูุฉ
- ุชุนููู ุงูููุงู ูููุฑูู
- ูุธุงู ุงูุฃููููุงุช

### 2. ุฅุฏุงุฑุฉ ุงููุฑูู  
- ุซูุงุซ ูุณุชููุงุช ุตูุงุญูุงุช: ูุฏูุฑุ ูุดุฑูุ ูุณุชุฎุฏู
- ูุธุงู ุงูููุงููุฉ ุนูู ุงููุณุชุฎุฏููู
- ุฅุฏุงุฑุฉ ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช

### 3. ูุธุงู ุงููุฑุงุณูุฉ
- ูุฑุงุณูุฉ ููุฑูุฉ ุจูู ุฃุนุถุงุก ุงููุฑูู
- ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ ููููุงู ุงูุฌุฏูุฏุฉ
- ุณุฌู ุดุงูู ูููุญุงุฏุซุงุช

### 4. ุชูููู ุฑุถุง ุงูุนููุงุก
- ุฅุฑุณุงู ุชููุงุฆู ุนุจุฑ ูุงุชุณุงุจ ุนูุฏ ุฅูุฌุงุฒ ุงูููุงู
- ุซูุงุซ ูุณุชููุงุช ุชูููู
- ุชูุงุฑูุฑ ุดุงููุฉ ููุฑุถุง

### 5. ูุธุงู ุงูููุงุท ูุงูููุงูุขุช
- ููุงุท ุชููุงุฆูุฉ ุนูุฏ ุฅูุฌุงุฒ ุงูููุงู
- ููุญุฉ ุงููุชุตุฏุฑูู
- ูุธุงู ุงูููุงูุขุช

## ุฅุนุฏุงุฏุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฅุนุฏุงุฏ PostgreSQL:
1. ุซุจุช PostgreSQL ูู ุงููููุน ุงูุฑุณูู
2. ุฃูุดุฆ ูุงุนุฏุฉ ุจูุงูุงุช: taskflow_db
3. ุนุฏู ููู .env:

\`\`\`
DATABASE_URL=postgresql://postgres:ูููุฉ_ุงููุฑูุฑ@localhost:5432/taskflow_db
SESSION_SECRET=ููุชุงุญ_ุณุฑู_ุนุดูุงุฆู_ุทููู
NODE_ENV=production  
PORT=5000
\`\`\`

## ุฅุนุฏุงุฏุงุช ุงูุฃูุงู

### Windows Firewall:
- ุณูุชู ูุชุญ ุงููููุฐ 5000 ุชููุงุฆูุงู
- ูููุชุญ ุงููุฏูู: Windows Firewall > Inbound Rules > New Rule

### ุฃูุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
- ุงุณุชุฎุฏู ูููุฉ ูุฑูุฑ ูููุฉ ูู PostgreSQL
- ูุนูู ุงูุชุดููุฑ ูู ุงูุงุชุตุงูุงุช
- ุงุนูู ูุณุฎ ุงุญุชูุงุทูุฉ ุฏูุฑูุฉ

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดููุฉ: ุงูุชุทุจูู ูุง ูุนูู
- ุชุฃูุฏ ูู ุชุดุบูู PostgreSQL
- ุชุญูู ูู ุตุญุฉ ุฅุนุฏุงุฏุงุช .env
- ุชุฃูุฏ ูู ูุชุญ ุงููููุฐ 5000

### ูุดููุฉ: ูุง ูููู ุงููุตูู ูู ุงูุดุจูุฉ
- ุชุญูู ูู ุฅุนุฏุงุฏุงุช Windows Firewall
- ุชุฃูุฏ ูู ุฅุนุฏุงุฏุงุช ุงูุดุจูุฉ

### ูุดููุฉ: ุฎุทุฃ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุชุญูู ูู ูููุฉ ูุฑูุฑ PostgreSQL
- ุชุฃูุฏ ูู ูุฌูุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช taskflow_db

## ุงููุณุฎ ุงูุงุญุชูุงุทู

### ูุณุฎ ุงุญุชูุงุทู ููุงุนุฏุฉ ุงูุจูุงูุงุช:
\`\`\`cmd
pg_dump -U postgres -h localhost taskflow_db > backup.sql
\`\`\`

### ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ:
\`\`\`cmd  
psql -U postgres -h localhost -d taskflow_db < backup.sql
\`\`\`

## ุงูุตูุงูุฉ

### ุชุญุฏูุซ ุงูุชุทุจูู:
1. ุฃููู ุงูุชุทุจูู
2. ุงุณุชุจุฏู ุงููููุงุช ุงูุฌุฏูุฏุฉ
3. ุฃุนุฏ ุชุดุบูู ุงูุชุทุจูู

### ูุฑุงูุจุฉ ุงูุฃุฏุงุก:
- ุฑุงูุจ ุงุณุชุฎุฏุงู ุงูุฐุงูุฑุฉ ูุงููุนุงูุฌ
- ุชุญูู ูู ูุณุงุญุฉ ุงููุฑุต ุงูุตูุจ
- ุฑุงุฌุน ุณุฌูุงุช ุงููุธุงู ุจุงูุชุธุงู

## ุงูุฏุนู ุงูููู
ููุญุตูู ุนูู ุงูุฏุนู ุงูููู:
- ุฑุงุฌุน ููู "ุญู ุงููุดุงูู.txt"
- ุชุญูู ูู ุณุฌูุงุช ุงููุธุงู
- ุงุชุตู ุจูุฑูู ุงูุฏุนู

## ุฑูู ุงูุฅุตุฏุงุฑ
ุงูุฅุตุฏุงุฑ: 1.0.0
ุชุงุฑูุฎ ุงูุจูุงุก: ${new Date().toLocaleDateString('ar-SA')}

---
ุฌููุน ุงูุญููู ูุญููุธุฉ - ุดุฑูุฉ ุงุดุฑุงู ุงููุฏู ูุชูููููุฌูุง ุงููุนูููุงุช`;

fs.writeFileSync('TaskFlow-Standalone/ุฏููู ุงููุณุชุฎุฏู.txt', userGuide);

// ููู ุญู ุงููุดุงูู
const troubleshooting = `# TaskFlow - ุญู ุงููุดุงูู ุงูุดุงุฆุนุฉ

## ูุดุงูู ุงูุชุดุบูู

### ุงููุดููุฉ: "ุงูุชุทุจูู ูุง ูุจุฏุฃ"
ุงูุญููู:
1. ุชุฃูุฏ ูู ูุฌูุฏ ููู .env
2. ุชุญูู ูู ุฅุนุฏุงุฏุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. ุชุฃูุฏ ูู ุชุดุบูู PostgreSQL
4. ุดุบู ููุฏูุฑ

### ุงููุดููุฉ: "Port 5000 is already in use"  
ุงูุญููู:
1. ุบูุฑ ุงููููุฐ ูู ููู .env (PORT=3000)
2. ุฃููู ุงูุชุทุจูู ุงูุขุฎุฑ ุงูุฐู ูุณุชุฎุฏู ุงููููุฐ
3. ุฃุนุฏ ุชุดุบูู Windows Server

### ุงููุดููุฉ: "Cannot connect to database"
ุงูุญููู:
1. ุชุฃูุฏ ูู ุชุดุบูู PostgreSQL
2. ุชุญูู ูู ูููุฉ ุงููุฑูุฑ ูู .env
3. ุชุฃูุฏ ูู ูุฌูุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช taskflow_db
4. ุชุญูู ูู ุฅุนุฏุงุฏุงุช PostgreSQL

## ูุดุงูู ุงูุดุจูุฉ

### ุงููุดููุฉ: "ูุง ูููู ุงููุตูู ูู ุฃุฌูุฒุฉ ุฃุฎุฑู"
ุงูุญููู:
1. ุชุญูู ูู Windows Firewall
2. ุชุฃูุฏ ูู ูุชุญ ุงููููุฐ 5000
3. ุชุญูู ูู ุฅุนุฏุงุฏุงุช ุงูุดุจูุฉ ุงููุญููุฉ
4. ุงุณุชุฎุฏู ุงูุฑุงุจุท: http://[ุงุณู-ุงูุฎุงุฏู]:5000

### ุงููุดููุฉ: "ุจุทุก ูู ุงูุชุทุจูู"
ุงูุญููู:
1. ุชุญูู ูู ุงุณุชุฎุฏุงู ุงูุฐุงูุฑุฉ
2. ุฑุงูุจ ุงุณุชุฎุฏุงู ุงููุนุงูุฌ
3. ุชุญูู ูู ูุณุงุญุฉ ุงููุฑุต ุงูุตูุจ
4. ุฃุนุฏ ุชุดุบูู ุงูุชุทุจูู

## ูุดุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงููุดููุฉ: "Database connection failed"
ุงูุญููู:
1. ุชุญูู ูู ุฎุฏูุฉ PostgreSQL
2. ุชุฃูุฏ ูู ุตุญุฉ DATABASE_URL ูู .env
3. ุชุญูู ูู ุตูุงุญูุงุช ุงููุณุชุฎุฏู postgres
4. ุฃุนุฏ ุชุดุบูู PostgreSQL

### ุงููุดููุฉ: "Table does not exist"
ุงูุญููู:
1. ุชุฃูุฏ ูู ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุดูู ุตุญูุญ
2. ุชุญูู ูู ุฅูุดุงุก ุงูุฌุฏุงูู ุงููุทููุจุฉ
3. ุฑุงุฌุน ุณุฌูุงุช ุงูุชุทุจูู

## ูุดุงูู ุชุณุฌูู ุงูุฏุฎูู

### ุงููุดููุฉ: "ุจูุงูุงุช ุชุณุฌูู ุงูุฏุฎูู ุฎุงุทุฆุฉ"
ุงูุญููู:
1. ุงุณุชุฎุฏู: administrator / wdq@#$
2. ุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ูุณุงูุงุช ุฒุงุฆุฏุฉ
3. ุชุญูู ูู ุญุงูุฉ ุงูุฃุญุฑู (Case Sensitive)

### ุงููุดููุฉ: "ูุณูุงู ูููุฉ ุงููุฑูุฑ"
ุงูุญููู:
1. ุงุณุชุฎุฏู ุงูุญุณุงุจ ุงูุงูุชุฑุงุถู: administrator
2. ุฑุงุฌุน ุฅุนุฏุงุฏุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. ุฃุนุฏ ุฅูุดุงุก ุงูุญุณุงุจ ุงูุฅุฏุงุฑู

## ุฃูุงูุฑ ูููุฏุฉ

### ูุญุต ุญุงูุฉ PostgreSQL:
\`\`\`cmd
net start postgresql*
\`\`\`

### ุฅุนุงุฏุฉ ุชุดุบูู PostgreSQL:
\`\`\`cmd  
net stop postgresql*
net start postgresql*
\`\`\`

### ูุญุต ุงูููุงูุฐ ุงููุณุชุฎุฏูุฉ:
\`\`\`cmd
netstat -an | findstr :5000
\`\`\`

### ูุชุญ ุงููููุฐ ูู Windows Firewall:
\`\`\`cmd
netsh advfirewall firewall add rule name="TaskFlow" dir=in action=allow protocol=TCP localport=5000
\`\`\`

## ุณุฌูุงุช ุงููุธุงู

### ุนุฑุถ ุณุฌูุงุช ุงูุชุทุจูู:
- ุชุญูู ูู ูุงูุฐุฉ Command Prompt
- ุฑุงุฌุน Event Viewer ูู Windows
- ุงูุญุต ุณุฌูุงุช PostgreSQL

### ุฃูุงูู ูููุงุช ุงูุณุฌูุงุช:
- PostgreSQL: C:\\Program Files\\PostgreSQL\\[version]\\data\\log
- Windows Event Logs: Event Viewer > Application

## ูุตุงุฆุญ ููุฃุฏุงุก

### ุชุญุณูู PostgreSQL:
1. ุฒูุฏ shared_buffers ูู postgresql.conf
2. ุงุถุจุท effective_cache_size
3. ูุนูู checkpoint_completion_target

### ุชุญุณูู Windows Server:
1. ูุนูู High Performance power plan
2. ููู ูู ุงูุฎุฏูุงุช ุบูุฑ ุงููุทููุจุฉ
3. ุฑุงูุจ ุงุณุชุฎุฏุงู ุงูููุงุฑุฏ

## ูุณุฎ ุงุญุชูุงุทูุฉ ุทุงุฑุฆุฉ

### ุญูุธ ุฅุนุฏุงุฏุงุช ุงูุชุทุจูู:
\`\`\`cmd
copy .env backup-env.txt
\`\`\`

### ูุณุฎ ุงุญุชูุงุทู ุณุฑูุน ููุงุนุฏุฉ ุงูุจูุงูุงุช:
\`\`\`cmd
pg_dump -U postgres taskflow_db > emergency-backup.sql
\`\`\`

---
ุฅุฐุง ูู ุชุญู ูุฐู ุงูุญููู ูุดููุชูุ ุงุชุตู ุจูุฑูู ุงูุฏุนู ุงูููู`;

fs.writeFileSync('TaskFlow-Standalone/ุญู ุงููุดุงูู.txt', troubleshooting);

console.log('๐ [8/8] ุฅูุดุงุก ููู ุงููุนูููุงุช ุงูููุงุฆู...');
// ููู ูุนูููุงุช ุงููุธุงู
const systemInfo = `TaskFlow - ูุธุงู ุฅุฏุงุฑุฉ ุงูููุงู ูุงููุฑู
ุดุฑูุฉ ุงุดุฑุงู ุงููุฏู ูุชูููููุฌูุง ุงููุนูููุงุช

===============================================
              ูุนูููุงุช ุงูุฅุตุฏุงุฑ
===============================================

ุงูุงุณู: TaskFlow Server
ุงูุฅุตุฏุงุฑ: 1.0.0 - ุงูุฅุตุฏุงุฑ ุงูุดุงูู
ุงูููุน: ุชุทุจูู ูุณุชูู (Standalone)
ุงููุธุงู: Windows Server
ุชุงุฑูุฎ ุงูุจูุงุก: ${new Date().toLocaleDateString('ar-SA')}

===============================================
                ุงููุญุชููุงุช
===============================================

๐ ุงููููุงุช ุงูุฑุฆูุณูุฉ:
  โก TaskFlow.exe - ุงูููู ุงูุชูููุฐู ุงูุฑุฆูุณู
  ๐ ุชุดุบูู TaskFlow.bat - ุณูุฑููพุช ุงูุชุดุบูู ุงูุฐูู
  ๐ง ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช.bat - ุฅุนุฏุงุฏ PostgreSQL
  ๐ ุชุซุจูุช ูุฎุฏูุฉ ูููุฏูุฒ.bat - ุชุซุจูุช ูุฎุฏูุฉ

๐ ูููุงุช ุงูุฅุนุฏุงุฏ:
  โ๏ธ .env.example - ูุงูุจ ุฅุนุฏุงุฏุงุช ุงููุธุงู
  ๐ .env - ุฅุนุฏุงุฏุงุช ุงููุธุงู (ุณูุชู ุฅูุดุงุคู)

๐ ุงููุซุงุฆู:
  ๐ ุฏููู ุงููุณุชุฎุฏู.txt - ุฏููู ุดุงูู ููุงุณุชุฎุฏุงู
  ๐ ุญู ุงููุดุงูู.txt - ุญููู ูููุดุงูู ุงูุดุงุฆุนุฉ
  โน๏ธ ูุนูููุงุช ุงููุธุงู.txt - ูุฐุง ุงูููู

===============================================
              ุงูุชุดุบูู ุงูุณุฑูุน
===============================================

ูููุฑุฉ ุงูุฃููู:
1. ุดุบู "ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช.bat"
2. ุดุบู "ุชุดุบูู TaskFlow.bat"

ููุงุณุชุฎุฏุงู ุงููููู:
- ุดุบู "ุชุดุบูู TaskFlow.bat"

ูุฎุฏูุฉ ูููุฏูุฒ:
- ุดุบู "ุชุซุจูุช ูุฎุฏูุฉ ูููุฏูุฒ.bat" (ููุฏูุฑ)

===============================================
              ูุนูููุงุช ุงููุตูู
===============================================

ุงูุฑุงุจุท ุงููุญูู: http://localhost:5000
ุงูุฑุงุจุท ุนูู ุงูุดุจูุฉ: http://[ุงุณู-ุงูุฎุงุฏู]:5000

ุจูุงูุงุช ุงูุฏุฎูู ุงูุงูุชุฑุงุถูุฉ:
ุงุณู ุงููุณุชุฎุฏู: administrator
ูููุฉ ุงููุฑูุฑ: wdq@#$

===============================================
               ูุชุทูุจุงุช ุงููุธุงู
===============================================

โ Windows Server 2016 ุฃู ุฃุญุฏุซ
โ PostgreSQL 12 ุฃู ุฃุญุฏุซ  
โ 4 GB RAM (8 GB ูููุตู ุจู)
โ 2 GB ูุณุงุญุฉ ุญุฑุฉ
โ ุฅูุชุฑูุช (ูููุงุชุณุงุจ)

===============================================
                ุงูููุฒุงุช ุงููุชุถููุฉ
===============================================

โ ุฅุฏุงุฑุฉ ุงูููุงู ูุงููุดุงุฑูุน
โ ูุธุงู ุงููุฑู ุซูุงุซู ุงููุณุชููุงุช
โ ูุฑุงุณูุฉ ููุฑูุฉ
โ ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ
โ ุชูููู ุฑุถุง ุงูุนููุงุก (ูุงุชุณุงุจ)
โ ูุธุงู ุงูููุงุท ูุงูููุงูุขุช
โ ุฅุฏุงุฑุฉ ุนูุงูุงุช ุงูุนููุงุก ูุน GPS
โ ูุงุฌูุฉ ุนุฑุจูุฉ ูุงููุฉ
โ ุชูุงุฑูุฑ ุดุงููุฉ
โ ูุธุงู ุงูุณุฌูุงุช
โ ุฅุฏุงุฑุฉ ุงููููุงุช ุงูุดุฎุตูุฉ

===============================================
                 ุงูุฃูุงู
===============================================

๐ ุชุดููุฑ ูููุงุช ุงููุฑูุฑ
๐ ุฌูุณุงุช ุขููุฉ
๐ ุตูุงุญูุงุช ูุชุฏุฑุฌุฉ
๐ ุณุฌูุงุช ุดุงููุฉ ูุฌููุน ุงูุนูููุงุช
๐ ูุณุฎ ุงุญุชูุงุทูุฉ ุชููุงุฆูุฉ

===============================================
                ุงูุฏุนู ุงูููู
===============================================

๐ ููุฏุนู ุงูููู: ุฑุงุฌุน "ุญู ุงููุดุงูู.txt"
๐ง ููุงุณุชูุณุงุฑุงุช: ุฑุงุฌุน "ุฏููู ุงููุณุชุฎุฏู.txt"
๐ง ููุตูุงูุฉ: ุฑุงุฌุน ุงููุซุงุฆู ุงููุฑููุฉ

===============================================
              ููุงุญุธุงุช ูููุฉ
===============================================

โ๏ธ ุบูุฑ ูููุฉ ุงููุฑูุฑ ุงูุงูุชุฑุงุถูุฉ ููุฑ ุงูุชุดุบูู
โ๏ธ ุงุนูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฏูุฑูุงู
โ๏ธ ุฑุงูุจ ุณุฌูุงุช ุงููุธุงู ุจุงูุชุธุงู
โ๏ธ ุญุฏุซ ุงูุชุทุจูู ุนูุฏ ุชููุฑ ุฅุตุฏุงุฑุงุช ุฌุฏูุฏุฉ

===============================================

ุฌููุน ุงูุญููู ูุญููุธุฉ
ุดุฑูุฉ ุงุดุฑุงู ุงููุฏู ูุชูููููุฌูุง ุงููุนูููุงุช
${new Date().getFullYear()}`;

fs.writeFileSync('TaskFlow-Standalone/ูุนูููุงุช ุงููุธุงู.txt', systemInfo);

// ุชูุธูู ุงููููุงุช ุงููุคูุชุฉ
if (fs.existsSync('package-standalone.json')) {
  fs.unlinkSync('package-standalone.json');
}

console.log('โ ุชู ุฅูุดุงุก TaskFlow ุงูุดุงูู ุจูุฌุงุญ!');
console.log('');
console.log('===============================================');
console.log('๐ ูุฌูุฏ ุงูุชุทุจูู ุงูุดุงูู: TaskFlow-Standalone/');
console.log('โก ุงูููู ุงูุชูููุฐู: TaskFlow.exe');
console.log('๐ ููุชุดุบูู: ุชุดุบูู TaskFlow.bat');
console.log('๐ง ููุฅุนุฏุงุฏ: ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช.bat');
console.log('===============================================');